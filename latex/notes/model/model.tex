\documentclass[a4paper,onecolumn,fleqn]{article}
\textwidth 17cm \textheight 247mm
\topmargin -4mm
\hoffset -9mm \voffset -14mm
%\setlength{\topmargin}{-0.8truecm}
\setlength{\oddsidemargin}{0.3cm}
\setlength{\evensidemargin}{0.3cm}
\setlength{\columnsep}{8mm}
\setlength{\parindent}{0mm}
\setlength{\parskip}{-2.0ex}
\setlength{\mathindent}{0mm}
\flushbottom


\usepackage{epsfig}
%\usepackage{timesnew}
% \usepackage{harvard}
% \usepackage[]{natbib}
\usepackage{amsmath}
\usepackage{booktabs}

\usepackage[latin1]{inputenc}
% \usepackage{aeguill}
\usepackage[english]{babel}
\usepackage{caption}
\usepackage{pgfgantt}


\setlength{\parskip}{2ex} \pagestyle{myheadings}
% \markright{\hspace*{3.8cm} \textit{MOSIM18 - June 27-29, 2018 - Toulouse - France}}

\renewcommand{\thepage}{}
\renewcommand{\refname}{REFERENCES}



\makeatletter
\renewcommand\section{\@startsection{section}{1}{\z@}%
                       {-6\p@ \@plus -0\p@ \@minus -0\p@}%
                       {2\p@ \@plus 0\p@ \@minus 0\p@}%
                       {\normalsize\textbf}}

\renewcommand\subsection{\@startsection{subsection}{2}{\z@}%
                       {-6\p@ \@plus -0\p@ \@minus -0\p@}%
                       {2\p@ \@plus 0\p@ \@minus 0\p@}%
                       {\normalsize\textbf}}

\renewcommand\subsubsection{\@startsection{subsubsection}{3}{\z@}%
                       {-6\p@ \@plus -0\p@ \@minus -0\p@}%
                       {1\p@ \@plus 0\p@ \@minus 0\p@}%
                       {\normalsize\itshape\bfseries}}
\makeatother


\begin{document}

\section{Mathematical formulation}
  \label{sec:model}

The following model provides a tight MIP formulation that solves the Military Flight and Maintenance Problem described in section \ref{sec:problem}. Maintenance operations will be referred as "checks".

\subsection{Input data}
    \subsubsection{Basic sets}

        \begin{tabular}{p{5mm}p{120mm}}
            $\mathcal{I}$     &  aircraft. \\
            $\mathcal{T}$     &  time periods included in the planning horizon. \\
            $\mathcal{J}$     &  missions. \\
            $\mathcal{K}$     &  cluster of aircraft that share the same functionality. \\
        \end{tabular}

    \subsubsection{Parameters}

        \begin{tabular}{p{10mm}p{115mm}}
            $H_j$             & amount of flight time required by mission $j$. \\
            $R_j$             & number of aircraft required by mission $j$. \\
            $MT_j$            & minimum number of consecutive periods an aircraft has to be assigned to mission $j$. \\
            $U^{min}$       & default aircraft flight time if it is not assigned to any mission nor in maintenance.\\
            $M$               & check duration in number of periods. \\
            $C^{max}$         & maximum number of simultaneous checks. \\
            $E^M$         & maximum number of periods between two consecutive checks. \\
            $E^m$         & minimum number of periods between two consecutive checks. \\
            $H^M$               & remaining flight time after a check. \\
            $N_t$             & number of aircraft known to be in maintenance in period $t$.\\
            $N^K_{kt}$         & number of aircraft in cluster $k$ known to be in maintenance in period $t$.\\
            $A^K_{kt}$         & maximum number of aircraft in cluster $k$ that can be simultaneously in maintenance in period $t$.\\
            $H^K_{kt}$         & minimum number of total remaining flight time for cluster $k$ at period $t$.\\
            $Rft^{Init}_i$  & remaining flight time for aircraft $i$ at the start of the planning horizon. \\
            $Rct^{Init}_i$  & remaining calendar time for aircraft $i$ at the start of the planning horizon. \\
        \end{tabular}

    \subsubsection{Parametric sets}

        \begin{tabular}{p{5mm}p{120mm}}
            $\mathcal{T}_j$     &  time periods $t \in \mathcal{T}$ in which mission $j$ is active. \\
            $\mathcal{J}_t $    &  missions $j \in \mathcal{J}$ to be realized in period $t$. \\
            $\mathcal{I}_j$     &  aircraft $i \in \mathcal{I}$ that can be assigned to mission $j$. \\
            $\mathcal{I}_k$     &  aircraft $i \in \mathcal{I}$ that are included in cluster $k$. One aircraft can belong to more than one cluster. \\
            $\mathcal{O}_i$     &  missions $j \in \mathcal{J}$ for which aircraft $i$ can be used. \\
            $\mathcal{A}^{init}_j$  & aircraft $i \in \mathcal{I}$ that have mission $j$ pre-assigned in the previous period to the start of the planning horizon. \\
        \end{tabular}

    \subsubsection{Time-related parametric sets}

        Several intermediate sets have been defined based on the input data in order to simplify constraint formulation.

        \begin{tabular}{p{8mm}p{117mm}}
            $\mathcal{T}^s_t$ &  time periods $t' \in \mathcal{T}$ such that $t' \in \{ \max{\{1, t - M+1\}},  ..., {t}\}$ (figure \ref{fig:gantt_windows}a). \\
            % $\mathcal{T}^S_t$ &  time periods $t' \in \mathcal{T}$ such that $t' \in \{ {t},  ..., \min{\{|\mathcal{T}|, t + M-1\}}\}$ (figure \ref{fig:gantt_windows}a). \\
            $\mathcal{T}^m_t$ &  time periods $t' \in \mathcal{T}$ such that $t' \in \{ {t}, ..., \min{\{|\mathcal{T}|, t + M + E^m-1\}}\}$ (figure \ref{fig:gantt_windows}a). \\
            $\mathcal{T}^M_t$ &  time periods $t' \leq |\mathcal{T}| - E^M - M$ such that $t' \in \{ t + M + E^m-1 , ...,  t + M + E^M-1 \}$ (figure \ref{fig:gantt_windows}a). \\
            $\mathcal{T}^{m_{ini}}_i$ &  time periods $t \in \mathcal{T}$ such that $t \in \{ 1, ..., \max{\{0, Rct^{Init}_i - E^M + E^m \}}\}$ (figure \ref{fig:gantt_windows}b). \\
            $\mathcal{T}^{M_{ini}}_i$ &  time periods $t \in \mathcal{T}$ such that $t \in \{ \max{\{0, Rct^{Init}_i - E^M + E^m \}} , ...,  Rct^{Init}_i \}$ (figure \ref{fig:gantt_windows}b). \\
            $\mathcal{T}^{MT}_{jt}$ &  time periods $t' \in \mathcal{T}$ such that $t' \in \{ \max{\{1, t - MT_j\}},  ..., {t}\}$ (figure \ref{fig:gantt_windows}c). \\
            $\mathcal{T}\mathcal{T}\mathcal{J}_{jt}$ & pairs of time periods $t_1, t_2 \in \mathcal{T}_j$ such that $t_2 \ge t_1 + MT_j-1$ and $t \in \{t_1, ..., t_2\}$. \\
            $\mathcal{T}\mathcal{T}\mathcal{T}_{t}$ & pairs of time periods $t_1 \in \mathcal{T}, t_2 \in \mathcal{T}^M_{t_1}$ such that $t_1 \in \mathcal{T}^s_{t} \lor t_2 \in \mathcal{T}^s_{t}$. \\
        \end{tabular}

    \begin{figure}
        \centering
        % \includegraphics[width=\linewidth]{img/gantt_timewindows_all.png}
        \begin{tikzpicture}
            \input{gantts/time_windows.tex}
        \end{tikzpicture}
        \begin{tikzpicture}
            \input{gantts/time_windows_init.tex}
        \end{tikzpicture}
        \begin{tikzpicture}
            \input{gantts/time_windows_mission.tex}
        \end{tikzpicture}
        \caption{Example showing the maintenance-related time-parametric sets for aircraft $i$. (a) $\mathcal{T}_{t'}^{s}$ refers to the previous $M$ periods to period $t'$. $\mathcal{T}_{t}^{m}$ refers to the periods where a check cannot be planned after starting a check in period $t$. Finally, $\mathcal{T}_{t}^{M}$ refers to the periods where a check needs to be scheduled, after starting a check in period $t$. (b) $Rct_{i}^{Init}$ is equal to 40, meaning a check has to be planned between months number 10 and 39. (c) $\mathcal{T}_{jt}^{MT}$ refers to the periods where the assignment of mission $j$ needs to be kept. In this case, the size is 6.} 
        \label{fig:gantt_windows}
    \end{figure}

\subsection{Variables}

    The following decision variables control the assignment of missions and checks to aircraft.

    \begin{tabular}{p{8mm}p{117mm}}
        $a_{ijtt'}$ &  =1 if aircraft $i$ starts a new assignment to mission $j$ at the beginning of period $t$ and finishes it at the end of period $t'$. \\  
        $m_{itt'}$  &  =1 if aircraft $i \in I$ starts a check at the beginning of period $t \in \mathcal{T}$ and then starts the next one at the beginning of period $t'$, 0 otherwise. \\
    \end{tabular}

    The following decision variables control the used and remaining flight time in aircraft.

    \begin{tabular}{p{8mm}p{117mm}}
        $u_{it}$    &  flown time (continuous) by aircraft $i \in I$ during period $t \in \mathcal{T}$. \\        
        $rft_{it}$  &  remaining flight time (continuous) for aircraft $i \in I$ at the end of period $t \in \mathcal{T}$. \\  
    \end{tabular}

    \paragraph{Fixed values}

    Note that $a_{ijtt'}$ and $m_{itt'}$ are initially set up to 0 for all aircraft already in maintenance at the beginning of the planning horizon for the remaining time periods of the check. $N_{t}$ is calculated based on this information.
Similarly, for aircraft that have not yet complied with their minimum mission assignment duration at the beginning of the planning horizon, $a_{ijtt'}$ is fixed to comply with the constraints.

\subsection{Objective function and constraints}

    Two objectives have been studied. Objective (\ref{eq:objective1}) minimizes the number of checks. (\ref{eq:objective2}) combines the first one with the goal of maximizing the final total flight hours potential of the fleet.

    % TODO: do not count maints that start at the end
    \begin{align}
        & \text{Min}\; \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}, i \in \mathcal{I}} m_{it_1t_2}  \label{eq:objective1}\\
        & \text{Min}\; \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}, i \in \mathcal{I}} m_{it_1t_2} \times H^M - \sum_{i \in \mathcal{I}} rft_{i|\mathcal{T}|} \label{eq:objective2}
    \end{align}
    
    The first term counts all the flight hours given to aircraft following checks and the second term quantifies the amount of remaining flight hours for all aircraft at the end of the planning horizon. These two objectives have the same units, can be easily compared and ensure the aircraft are used in the most efficient way. %We will not penalize the maintenances that provide a better final state for aircraft.

    The following constraints are used in the model:
    \begin{align}
        % maximum capacity1:
        & \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}} \sum_{i \in \mathcal{I}} m_{it_1t_2} + N_t \leq C^{max}
          & t \in \mathcal{T} \label{eq:capacity1}\\
        % min assignments:
        & \sum_{i \in \mathcal{I}_j} \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{J}_{jt}} a_{ijt_1t_2} \geq R_j
                & j \in \mathcal{J}, t \in \mathcal{T}_j  \label{eq:missionres}\\
        % just doing one thing at any given time:
        & \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}} m_{it_1t_2} + \sum_{j \in \mathcal{J}_t \cap \mathcal{O}_i} \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{J}_{jt}} a_{ijt_1t_2} \leq 1 
                & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:state}
    \end{align}


    Maintenance capacity is controlled by (\ref{eq:capacity1}). The aircraft requirements of missions are defined by (\ref{eq:missionres}). Constraints (\ref{eq:state}) ensure that an aircraft can only be used for one mission or undergo check in the same period.

%     \begin{align}
%         % if start mission => assign start
%         & a^s_{jti} \geq a_{jti} - a_{j(t-1)i}
%                 & t =1, ..., \mathcal{T}, j \in \mathcal{J}_t, i \in \mathcal{I}_j \label{eq:start1} \\
%         & a^s_{j0i} \geq a_{j0i} - 1 \!1_{i \in \mathcal{A}^{init}_j}
%                 & j \in \mathcal{J}_0, i \in \mathcal{I}_j \label{eq:start2} \\
%         & \sum_{t' \in \mathcal{T}^{MT}_{jt}} a^s_{jt'i} \leq a_{jti} 
%         & j \in \mathcal{J}, t \in \mathcal{T}_j, i \in \mathcal{I}_j \label{eq:start3}
%     \end{align}

%     Constraints (\ref{eq:start1}) captures period $t$ where aircraft $i$ is firstly assigned to mission $j$ i.e. it was not assigned to it in period ($t - 1$). Constraints (\ref{eq:start2}) are introduced for the first period in the planning horizon.
% Constraints (\ref{eq:start3}) control the minimum duration of a consecutive mission assignment. If aircraft $i$ was firstly assigned to mission $j$ in period $t$, it has to be assigned to it during the following $t' \in \mathcal{T}_{jt}^{MT}$ periods. This is a stronger version of the constraint $a_{jt'i}^{s} \leq a_{jti}$.

    % To our knowledge, these constraints have not been taken into account in previous military FMP problems.

    \begin{align}
       & \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}} \sum_{i \in \mathcal{I}_k} m_{it_1t_2} + N^K_{kt} \leq A^K_{kt}
        &k \in \mathcal{K}, t \in \mathcal{T} \label{eq:serviceability-cluster} \\
       & \sum_{i \in \mathcal{I}_k} rft_{it} \geq H^K_{kt}
        &k \in \mathcal{K}, t \in \mathcal{T} \label{eq:sustainability-cluster}
    \end{align}

    Constraints (\ref{eq:serviceability-cluster}) guarantee a minimum serviceability of aircraft for each cluster $k$. A cluster is defined by the largest group of aircraft that is required exclusively for at least one mission. Constraints (\ref{eq:sustainability-cluster}) ensure there is a minimum amount of remaining flight time for each cluster $k$.

    \begin{align}
        % remaining used time
         & u_{it} \geq \sum_{j \in \mathcal{J}_t \cap \mathcal{O}_i} \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{J}_{jt}} a_{ijt_1t_2} H_j 
            & t =1, ..., \mathcal{T}, i \in \mathcal{I} \label{eq:flight1}\\
         & u_{it} \in [U^{min}, \max_j{\{H_j\}}]
            & t =1, ..., \mathcal{T}, i \in \mathcal{I} \label{eq:flight_lower}\\
         & rft_{it} \leq rft_{i(t-1)} + H^M \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}} m_{it_1t_2} - u_{it}
            & t =1, ..., \mathcal{T}, i \in \mathcal{I} \label{eq:rft_upper}\\
        & rft_{i0} = Rft^{Init}_i
               & i \in \mathcal{I} \label{eq:rft_initial}\\
        & rft_{it} \geq H^M \sum_{(t_1, t_2) \in \mathcal{T}\mathcal{T}\mathcal{T}_{t}} m_{it_1t_2}
                &t \in \mathcal{T}, i \in \mathcal{I}\label{eq:rft_lower}\\
        & rft_{it} \in [0,H^M]
                & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:mu}
    \end{align}

        % These constraints calculate the balances of hours for each aircraft.
    The flight time per aircraft and period is calculated in (\ref{eq:flight1})-(\ref{eq:flight_lower}). The remaining flight time is defined by (\ref{eq:rft_upper})-(\ref{eq:rft_initial}) and its limits by (\ref{eq:rft_lower})-(\ref{eq:mu}).

    \begin{align}
       % For now, we only want one or possibly two maintenances...
        & \sum_{t_1 \in \mathcal{T}, t_2 \in \mathcal{T}^M_{t_1} \cup \{|\mathcal{T}|\} } m_{it_1t_2} =  1 
          & i \in \mathcal{I}\label{eq:num_maint} \\
        % & m_{it'} + m_{it} \leq 1
        %   & t \in \mathcal{T}, t' \in \mathcal{T}^m_t, i \in \mathcal{I}\label{eq:rct_min}\\ 
        % & \sum_{t' \in \mathcal{T}^M_t} m_{it'} \geq  m_{it}
        %   & t \in \mathcal{T}, i \in \mathcal{I}\label{eq:rct_max}\\
        & m_{it_1t_2} = 0
          & t_1 \in \mathcal{T}^{m_{ini}}_i, t_2 \in \mathcal{T}^M_{t_1}, i \in \mathcal{I}\label{eq:rct_min_init} \\
        & \sum_{t_1 \in \mathcal{T}^{M_{ini}}_i, t_2 \in \mathcal{T}^M_{t_1} \cup \{|\mathcal{T}|\} } m_{it_1t_2} =  1 
          & i \in \mathcal{I}\label{eq:rct_max_init}
    \end{align}

    Constraints (\ref{eq:rct_min_init}) and (\ref{eq:rct_max_init}) control the minimum and maximum remaining calendar times respectively at the beginning of the planning period. 

\end{document}