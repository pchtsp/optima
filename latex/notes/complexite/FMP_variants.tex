\documentclass[a4paper,11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}

%opening
\title{Variants on the Flight and Maintenance Planning problem}
\author{}

\setlength{\topmargin}{-2.1cm}
\setlength{\textwidth}{15.8cm}
\setlength{\textheight}{26.3cm}
\setlength{\oddsidemargin}{-0.1cm}
\setlength{\evensidemargin}{-0.1cm}

\def\II{{\mathcal{I}}}
\def\TT{{\mathcal{T}}}
\def\KK{{\mathcal{K}}}
\def\JJ{{\mathcal{J}}}

\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{chngcntr}

\counterwithin*{equation}{section}
\counterwithin*{equation}{subsection}

\begin{document}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Problem presentation}

    The problem consists in assigning military aircraft to a given set of missions while scheduling the maintenance operations over a time horizon.

    In order to generalize the formulation, from now on aircraft will be named "resources" and missions will be named "tasks". A series of $j \in \mathcal{J}$ tasks are planned along a horizon divided into $t \in \mathcal{T}$ periods. Since all tasks are already scheduled, we know time periods $T_j \subset \mathcal{T}$ in which they will be realized. Similarly, all the tasks to be realized in period $t$ are known and defined by set $J_t \subset \mathcal{J}$. Each task requires a certain number $R_{j}$ of resources $i \in \mathcal{I}$ which it employs for a time duration defined by $H_j$ in each period. Set $I_{j} \subset \mathcal{I}$ lists the resources that can be assigned to each task and set $O_i \subset \mathcal{J}$ consists of tasks for which resource $i$ can be used. The number of resources in use for each period $D_t$ is also known.

    Each resource can only be assigned to a single task in any given period. These resources suffer from wear and tear and require regular maintenance operations during their lifetime. The need for maintenance is calculated based on two indicators.

    The first one is called "remaining elapsed time" (or $ret_{it}$). It expresses the amount of time (measured in time periods) after which the resource cannot be used any more and has to undergo a maintenance operation. Its value is calculated for each resource $i$ and each time period $t$. In a similar way, "remaining usage time" (or $rut_{it}$) is used to measure the amount of time that the resource $i$ can be used before needing a maintenance operation at any given period $t$.

    Each maintenance operation has a fix duration of $M$ periods and cannot be interrupted: during this time the resource cannot be assigned to any task. After a maintenance operation, a resource restores its remaining elapsed time and remaining usage time to their maximum values $E$ and $H$ respectively.

    Some resources can be in maintenance at the beginning of the planning horizon, $n_t$ is used for the number of aircraft in such planned maintenance per period $t$ and defined only for the first $m-1$ time periods.

    Given that the creation of new tasks and the duration of maintenance are considered stochastic in real-life, one basic goal is to maximize the robustness of the planning by having the greatest amount of available resources at every period of the planning horizon. 

    Given the limited amount of maintenance capacity and its cost, another goal is to smooth as much as possible the number of resources under maintenance over the planning horizon.


\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Crew scheduling variant}

    As presented in \cite{Brunner2013}. There, they prove the complexity by comparing the crew scheduling problem with the circulant problem. Below I do the same with our problem.

    \subsection{Hypothesis}

    \begin{itemize}
     \item fixed maintenance duration.
     \item fixed duration between maintenances.
     \item homogeneous fleet.
     \item objective: minimize the number of aircraft.
    \end{itemize}

    \subsection{Reductions}

    \begin{itemize}
        \item The missions consume 0 hours of aircraft.
        \item The minimum time between maintenances is equal to the maximum.
        \item All missions can use any aircraft.
    \end{itemize}

    \subsection{Limitations}

    \begin{itemize}
        \item There is not starting period.
    \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \begin{tabular}{ll}
    $t \in \mathcal{T} = [\![1, m]\!]$ & Planning horizon periods. \\
    $i \in \mathcal{P} = [\![1, n]\!]$ & Working pattern.\\
    \end{tabular}

    \vskip 0.3cm

    \subsection{Parameters}

    \begin{tabular}{ll}
        $D^{off}$ & Number of consecutive non-working days. \\
        $D^{on}$ & Number of consecutive working days. \\
        $\mathcal{A}_{it}$ & Pattern $i$ covers period $t$ (circulant matrix built from $D_{on}$ and $D_{off}$).\\
        $b_{t}$ & Need of resources at period $t$. \\
    \end{tabular}

    \vskip 0.3cm

    Example of A for $D_{on}=4$ and $D_{off}=2$

    $$
    \begin{bmatrix}
        1 & 0 & 0 & \dots  & A_{i1} \\
        1 & 1 & 0 & \dots  & A_{i2} \\
        1 & 1 & 1 & \dots  & A_{i3} \\
        1 & 1 & 1 & \dots  & A_{i4} \\
        0 & 1 & 1 & \dots  & A_{i5} \\
        0 & 0 & 1 & \dots  & A_{i6} \\
        1 & 0 & 0 & \dots  & A_{i6} \\
        \vdots & \vdots & \vdots & \ddots & \vdots \\
        A_{1t} & A_{2t} & A_{3t} & \dots  & A_{nm}
    \end{bmatrix}
    $$

    \subsection{Variables}

    \begin{itemize}
     \item $x_i$: number of patterns of type $i$ to be included in the solution.
    \end{itemize}

    \subsection{Model}

    \begin{align}
        & \text{Min}\; \sum_{i \in \mathcal{P}} x_i \label{numPatterns}
    \end{align}

    \begin{align}
        & \sum_{i \in \mathcal{P}} A_{it}x_{i} \geq d_j & t \in \mathcal{T} \label{demand} \\
        & x_{i} \geq 0,\, x_{i} \in \mathbb{Z} \\
    \end{align}

    (\ref{numPatterns}) minimizes the number of workers. (\ref{demand}) defines the need to have at least a given number of workers at any given time.  

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Set covering variant}

    \subsection{Hypothesis}

    \begin{itemize}
     \item only 1 aircraft needed per month.
     \item objective: minimize the number of aircraft.
    \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \begin{tabular}{ll}
    $t\in \mathcal{T} = [\![1, m]\!]$ & Planning horizon periods. \\
    $i \in \mathcal{P} = [\![1, n]\!]$ & Working pattern.\\
    \end{tabular}

    \vskip 0.3cm

    \subsection{Parameters}

    \begin{tabular}{ll}
        $\mathcal{A}_{it}$ & Pattern $i$ covers period $t$.\\
    \end{tabular}

    \vskip 0.3cm

    \subsection{Variables}

    \begin{itemize}
     \item $x_i$: is pattern $i$ in the solution or not.
    \end{itemize}

    \subsection{Model}

    \begin{align}
        & \text{Min}\; \sum_{i \in \mathcal{P}} x_i \label{numPatterns2}
    \end{align}

    \begin{align}
        & \sum_{i \in \mathcal{P}} A_{it}x_{i} \geq 1 & t \in \mathcal{T} \label{demand2} \\
        & x_{i} \in \{0, 1\} \\
    \end{align}

    (\ref{numPatterns2}) minimizes the number of workers. (\ref{demand2}) defines the need to have at least one worker working at any given time.  

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Scheduling variant}

    \subsection{Hypothesis}

    \begin{itemize}
     \item durée de maintenance définie
     \item fenêtres de temps pour commencer les maintenances
     \item objectif: lisser les maintenances dans les fenêtres de temps prédéfinies
    \end{itemize}


    \subsection{Notations}

    \noindent{
    \begin{tabular}{ll}
        $t\in \TT = [\![1, T]\!]$ & Discrétisation temporelle de l'horizon de planigfication. \\
        $i \in \II = [\![1, I]\!]$ & Ensemble des avions.\\
        $k \in \KK_i = [\![1, K_i]\!]$ & Ensemble des maintenances à planifier successivement.\\ 
    \end{tabular}
    }

    \vskip 0.3cm

    \textbf{Paramètres}


    \begin{tabular}{ll}
        $\mathbf{Da}_{i,k}$ & Durée nominale de la maintenance $k$ de l'avion $i$.\\
        $\mathbf{l}_{i}$ & Durée mininale du cycle de vol de l'avion $i$.\\
        $\mathbf{{To}}_{i,k}$ & Pas de temps le plus tôt pour commencer la maintenance $k$ de l'avion $i$.\\
        $\mathbf{{Ta}}_{i,k}$ & Pas de temps le plus tard pour terminer la maintenance $k$ de l'avion $i$.\\
    \end{tabular}

    % \caption{Definition and notations the challenge ROADEF}\label{contraintesROADEF}
    % \end{table}

    \subsection{Définition des variables}

    \begin{itemize}
     \item $d_{i,k,t}\in \{0,1\}$; variables binaires pour indiquer les dates d'arrêts, "step varaibles" 
    $d_{i,k,t}=1$ si l'arrêt du cycle $k$ du réacteur nucléaire $i$ a été commencé avant la semaine $t$.
    $d_{i,k,t}-d_{i,k,t- {\mathbf{Da}_{i,k}}} \in \{0,1\}$ vaut $1$ uniquement pendant a maintenance $(i,k)$.


     \item $m,M\geqslant 0$: variables continues pour linéariser la fonction objectif
    \end{itemize}


    \subsection{Formulation PLNE}


    \begin{eqnarray}
    \displaystyle \min_{d,m,M} & M-m
     & \\
    \forall i , k, t, & d_{i,k,t-1}\leqslant d_{i,k,t} & \label{PANprecedence}\\
    \forall i , k, & d_{i,k,\mathbf{To}_{i,k}-1}\leqslant 0 & \label{PANtw0} \\
    \forall i , k, & d_{i,k,\mathbf{Ta}_{i,k}}\geqslant 1 & \label{PANtw1}\\
    \forall i , k, t, & d_{i,k,t}\leqslant d_{i,k-1,t-l_i-\mathbf{Da}_{i,k}} & \label{PANprecedence2}\\
    \forall t, & \displaystyle \sum_{i,k} d_{i,k,t}-d_{i,k,t- {\mathbf{Da}_{i,k}}} \leqslant M & \label{maxMaint}\\
    \forall t, & \displaystyle \sum_{i,k} d_{i,k,t}-d_{i,k,t- {\mathbf{Da}_{i,k}}} \geqslant m & \label{minMaint}\\
    & d \in \{0,1\}^N, m,M \geqslant 0
    \end{eqnarray}

    (\ref{PANprecedence}): contrainte induite par la définition ``step variables".

    (\ref{PANtw0}), (\ref{PANtw1}): contraintes de fenêtres de temps (écrit explicitement, ou sinon définir uniquement les variables $d_{i,k,t}$
    dans les fenêtres de temps)

    (\ref{PANprecedence2}): durée minimale d'un cycle de vol $l\geqslant 0$, contrainte de succession des cycles.

    (\ref{maxMaint}), (\ref{minMaint}): contraites pour linéariser les $\min$ et $\max$ de la focntion objectif de lissage

    \subsection{Questions ouvertes}

    \begin{itemize}
    %\item Avec $l=0$ , y a t'il un problème de référence proche ? Ordonnancement, lissage de charge ?
    \item Avec $l=0$ , y a t'il un problème de référence proche ? Ordonnancement, lissage de charge ?
    \item Est-ce un problème NP-complet? Peut on le prouver ?
     \item Cas particulier $\mathbf{Ta}_{i,k}-\mathbf{To}_{i,k}=1$? (pour lissage local)
     \item Autres fonctions objectifs?
     \item version robuste avec aléas de prolongation de durée de maintenance?
    \end{itemize}

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Crew scheduling: smooth maintenances}

    \subsection{Hypothesis}

    \begin{itemize}
     \item fixed maintenance duration.
     \item range to start each maintenance.
     \item min distance between maintenances.
     \item objective: minimize the max number of maintenances.
    \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \begin{tabular}{ll}
    $t\in \mathcal{T} = [\![1, m]\!]$ & Planning horizon periods. \\
    $i \in \mathcal{P} = [\![1, n]\!]$ & Working pattern.\\
    \end{tabular}

    \vskip 0.3cm

    \subsection{Parameters}

    \begin{tabular}{ll}
        $\mathcal{A}_{it}$ & Pattern $i$ has a maintenance in $t$.\\
    \end{tabular}

    \vskip 0.3cm

    Here, A needs to be created taking into account:

    \begin{enumerate}
        \item The range of start of maintenances.
        \item The fixed duration of maintenances.
        \item The minimal distance between maintenances.
    \end{enumerate}

    \subsection{Variables}

    \begin{itemize}
        \item $x_i$: number of patterns of type $i$ to be included in the solution.
        \item $M$: maximum number of maintenance among all periods.
    \end{itemize}

    \subsection{Model}

    \begin{align}
        & \text{Min}\; M
    \end{align}

    \begin{align}
        & \sum_{i \in \mathcal{P}} A_{it}x_{i} \leq M & t \in \mathcal{T} \label{numMaint} \\
        & x_{i} \geq 0,\; integer \\
    \end{align}

        (\ref{numMaint}) defines the $M$ variable as the maximum number of maintenances at any period of time.


\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Scheduling variant 2}

    As modelled in \cite{Rieck2012} and \cite{Neumann2000}.

    \subsection{Hypothesis}

    \begin{itemize}
     \item fixed maintenance duration.
     \item min and max durations between maintenances that belong to the same aircraft.
     \item each maintenance uses an amount of resource. In this case 1.
     \item there is a maintenance capacity to respect at every period.
     \item objective: minimize the max number of maintenances.
     \item There are two artificial activities representing the start and end of the horizon.
     \item maintenance operations consume also resources of the missions.
    \end{itemize}

    \subsection{Reductions}

    \begin{itemize}
        \item The missions consume 0 hours of aircraft.
        %\item The missions require 0 aircraft at each period.
        \item Each aircraft can only be used for one mission.
    \end{itemize}

    \subsection{Limitations}

    \begin{itemize}
        \item Resource usage is always 1.
        %\item There is only one type of resource.
        \item All durations are the same.
    \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \noindent{
    \begin{tabular}{ll}
        $i \in \mathcal{V} = [\![1, n]\!]$ & Set of maintenance operations.\\
        $(i, j) \in \mathcal{E} = [\![1, v]\!]$ & Set of consecutive (i, j) maintenance operations, i.e. consecutive maintenances belonging to the same aircraft.\\
        $k \in \mathcal{R}$ & Types of resources that maintenance can take. We only have one type.\\
        $i = 0$ & Artificial starting node.\\
        $i = n+1$ & Artificial ending node.\\
    \end{tabular}
    }

    \vskip 0.3cm

    The set $\mathcal{A}$ we will construct it by deciding in advance the maintenances $i$ that share the same aircraft.

    \subsection{Parameters}

    \begin{tabular}{ll}
        $p_i$ & Duration of maintenance $i$. In this case it's always p=6.\\
        $\mathbf{d}$ & Last period on the horizon.\\
        $r_{ik}$ & Resources of type $k$ taken by maintenance $i$. In this case it's always 1.\\
        $d^{max}_{ij}$ & Maximum duration between two maintenances $i$ and $j$.\\
        $d^{min}_{ij}$ & Minimum duration between two maintenances $i$ and $j$.\\
        ${\delta}_{ij}$ & Precedence duration arcs between two maintenances $i$ and $j$ based on $d^{max}$ and $d^{min}$.\\
        $R_k$ & total maintenance capacity at each period for resource $k$.\\
        $c_k$ & cost per unit of investment on resource $k$.
        % $\mathbf{{To}}_{i,k}$ & Minimum starting period for maintenance $k$ of resource $i$.\\
        % $\mathbf{{Ta}}_{i,k}$ & Maximum starting period for maintenance $k$ of resource $i$.\\
    \end{tabular}

    \subsection{Variables}

    \begin{tabular}{ll}
        $S_i$ & the start of maintenance operation $i$.\\
        $\mathcal{A}(S^{\mathcal{C}}, t)$ & set of maintenance operations active at moment $t$.\\
    \end{tabular}

    \subsection{Model}

    The following formulation is taken from \cite{Neumann2000}.

    \begin{align}
        \min f(\mathbf{R}(S)) = \sum_{k \in \mathcal{R}} c_k \max_{t \in \mathcal{T}} r_k(S^{\mathcal{C}}, t)
    \end{align}

    \begin{align}
        & S_j - S_i \geq \delta_{ij} & (i, j) \in \mathcal{E}  \label{precedence}\\
        & S_0 = 0 &  \label{firstjob}\\
        & S_{n+1} \leq \mathbf{d}   \label{lastjob}\\
        & S_{i} \in \mathbb{Z}_{\geq 0} & i \in \mathcal{V}  \label{integervars}\\
        & r_k(S^{\mathcal{C}}, t) = \sum_{i \in \mathcal{A}(S^{\mathcal{C}}, t)} r_{ik}  \label{consumptiondef}\\
        & r_k(S^{\mathcal{C}}, t) \leq R_k \label{consumptionmax}\\
    \end{align}

    (\ref{precedence}) constraints define the relative minimum and maximum starting times of tasks.
    (\ref{firstjob}) and (\ref{lastjob}) constraints define the fictitious start and end jobs.
    (\ref{integervars}) define the range for the starting time variables: integer positive.
    (\ref{consumptiondef}) defines the used quantity for each type of resource depending on the starting times and durations and (\ref{consumptionmax}) defines the maximum amount of resources of each type that can be used at any given time.

    \subsection{Possible proof}

    \cite{Blazewicz1983} proved that the following problem is NP-Hard:

    $$P2 | res111, chain, p_j = 1 / C_{max}$$ is NP-hard via the 3 partition problem.

    This problem is, from what I understand, the following:

    \begin{itemize}
        \item The number of machines is 2.
        \item There is only one type of resource.
        \item The resource size is 1.
        \item The consumption of the resource by each job is upper bounded by 1.
        \item The duration of each job is 1.
        \item There is a chain precedence between jobs: a job can have at most one predecessor and one successor.
    \end{itemize}

    Here they use the machine and resource concept. This could be understood as there being TWO resource types. Not sure how to really come around this. Is the same, for example, as doing the following:

    $$P| res1R1, chain, p_j = 1 / C_{max}$$ Where I have an unlimited number of machines and a quantity R of available resource?

    Although they minimize the maximum completion time, the decision problem 'is there a planning that uses X number of resources and finishes before period Y' is the same as ours. When we pass to the optimization problem we just choose the number of resources instead of the time.


\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Three partition problem}


    \subsection{Hypothesis}

    \begin{itemize}
     \item assigned maintenances at regular intervals of M.
     \item We need to assign tasks in between maintenances.
     \item Each task assignment needs M/3 consecutif periods.
     \item Each task assignment has a flight hours consumption.
    \end{itemize}

    \subsection{Reductions}

    \begin{itemize}
        \item Missions have a fixed duration.
        \item Maintenances are evenly spaced.
        \item All maintenances start at the same time. Maybe only one maintenance per Aircraft.
        % \item The missions require 0 aircraft at each period.
        % \item Each aircraft can only be used for one mission.
    \end{itemize}

    \subsection{Limitations}

    \begin{itemize}
        \item The time at which each task is done matters.
        %\item There is only one type of resource.
        % \item All durations are the same.
    \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \noindent{
    \begin{tabular}{ll}
        $i \in \II = [\![1, I]\!]$ & Set of aircraft.\\
        % $k \in \KK_i = [\![1, K_i]\!]$ & Set of maintenances for aircraft $i$.\\ 
        $j \in J$ & Set of missions.\\ 
        % $i \in \mathcal{V} = [\![1, n]\!]$ & Set of maintenance operations.\\
        % $k \in \mathcal{R}$ & Types of resources that maintenance can take. We only have one type.\\
        % $i = 0$ & Artificial starting node.\\
        % $i = n+1$ & Artificial ending node.\\
    \end{tabular}
    }

    \subsection{Parameters}

    \begin{tabular}{ll}
    	$h_j$ & Flight hour consumption for each mission.\\
    	$M$ & Duration of maintenances.\\
    	$H$ & Flight hours given by maintenance.\\
        % $p_i$ & Duration of maintenance $i$. In this case it's always p=6.\\
        % $\mathbf{d}$ & Last period on the horizon.\\
        % $r_{ik}$ & Resources of type $k$ taken by maintenance $i$. In this case it's always 1.\\
        % $d^{max}_{ij}$ & Maximum duration between two maintenances $i$ and $j$.\\
        % $d^{min}_{ij}$ & Minimum duration between two maintenances $i$ and $j$.\\
        % ${\delta}_{ij}$ & Precedence duration arcs between two maintenances $i$ and $j$ based on $d^{max}$ and $d^{min}$.\\
        % $R_k$ & total maintenance capacity at each period for resource $k$.\\
        % $c_k$ & cost per unit of investment on resource $k$.
        % $\mathbf{{To}}_{i,k}$ & Minimum starting period for maintenance $k$ of resource $i$.\\
        % $\mathbf{{Ta}}_{i,k}$ & Maximum starting period for maintenance $k$ of resource $i$.\\
    \end{tabular}

    In theory, with this configuration we have a Three Partition problem. The problem lies that each task has a fixed time. They're not tasks, they're demand. 		

    % This doesn't make sense because the tasks are already defined. We cannot chose when it executes.

    % I'll continue with the idea nonetheless.
    % Imagine we preassign the aircraft a group of tasks. We need to decide at which moment we want to assign the tasks in the predefined maintenances.
    % In this way, we need to come up with an assignment of tasks for each cycle that has a total of 1000 flight hours.


\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Three partition problem v2}

    Inspired by \cite{Caprara2003}.

    \subsection{Hypothesis}

    \begin{itemize}
     \item all maintenances are already decided for all aircraft and they will happen in month 4.
     \item all aircraft come from receiving a maintenance so are full in availability and flight hours.
     \item each maintenance gives C flight hours.
     \item objective: comply with all the missions in time and arrive with 0 flight hours to the maintenance.
     \item each mission lasts for 3 months, needs 1 aircraft each month.
     \item There is no minimal assignment duration for missions.
    \end{itemize}

    % \subsection{Reductions}

    % \begin{itemize}
    %     \item The missions consume 0 hours of aircraft.
    %     %\item The missions require 0 aircraft at each period.
    %     \item Each aircraft can only be used for one mission.
    % \end{itemize}

    % \subsection{Limitations}

    % \begin{itemize}
    %     \item Resource usage is always 1.
    %     %\item There is only one type of resource.
    %     \item All durations are the same.
    % \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \noindent{
    \begin{tabular}{ll}
        $i \in \II = [\![1, M]\!]$ & Set of aircraft fleets. Each fleet has 3 aircraft.\\
        $j \in \mathcal{J} = [\![1, 3M]\!]$ & Set of missions.\\
        $t \in \TT = [\![1, 3]\!]$ & Set of periods.\\
        $p \in \mathcal{P} = [\![1, 3]\!]$ & Set of aircraft per fleet.\\
        $A_{ip}$ & Aircraft number $p$ of fleet $i$. \\
    \end{tabular}
    }

    \vskip 0.3cm

    \subsection{Parameters}

    \begin{tabular}{ll}
        $M$ & Number of fleets.\\
        $3M$ & Number of aircraft and missions.\\
        $D$ & Months between maintenances. Fixed to three.\\
        $h_j$ & Flight hour consumption for each mission.\\
        $C$ & Flight hours given by maintenance.\\
    \end{tabular}

    \subsection{Variables}

    \begin{tabular}{ll}
        $F_{ij}$ & Mission $j$ is done by fleet $i$. Binary. \\
        $a_{ipjt}$ & Mission $j$ is done by aircraft number $p$ from fleet $i$ in period $t$ (auxiliary). Binary. \\
    \end{tabular}

    \subsection{Model}

    It's a satisfaction problem where we want to use exactly all the available hours to do missions. We could also calculate the "waste hours just before the maintenance" and then it could be a minimisation problem.

    \begin{align}
        & \sum_{t \in \mathcal{T}, j \in \mathcal{J}} a_{ipjt} \times h_j = C & (i \in \mathcal{I}, p \in \mathcal{P}) \label{hours}\\
        & \sum_{i \in \mathcal{I}, p \in \mathcal{P}} a_{ipjt} = 1 & (j \in \mathcal{J}, t \in \mathcal{T}) \label{demand-TPP}\\
        & F_{ij} \leq \sum_{p \in \mathcal{P}, t \in \mathcal{T}} a_{ipjt} & (i \in \mathcal{I}, j \in \mathcal{J}) \label{auxiliary1}\\
        & F_{ij} \geq a_{ipjt} & (i \in \mathcal{I}, p \in \mathcal{P}, t \in \mathcal{T}, j \in \mathcal{J}) \label{auxiliary2}\\
        & \sum_{i \in \mathcal{I}} F_{ij} = 1 &  (j \in \mathcal{J}) \label{auxiliary3}\\
        & F_ij, a_{ipjt} \geq 0,\, F_{ij}, a_{ipjt} \in \mathbb{B}
    \end{align}

    (\ref{hours}) constraints force the number of hours each aircraft uses to be exactly the number of available hours.
    (\ref{demand-TPP}) constraints force the solution to have exactly 1 aircraft assigned to each mission at each period.
    (\ref{auxiliary1}) and (\ref{auxiliary2}) constraints tie the fleet assignment with the single aircraft assignment.
    (\ref{auxiliary3}) controls that each mission is only assigned to one fleet.

    \subsection{Possible proof}

    Each fleet is assigned three missions. These missions need to sum the available amount of flight hours (C).
    Because we need to satisfy the assignment of aircraft each month, each aircraft belonging to the fleet will have a different combination of the three missions (three permutations in a cycle: ABC, CBA, BCA).

    For example if the missions with flight hours (60, 30, 10) are assigned to fleet 1 and the missions with flight hours (50, 40, 10) are assigned to fleet "3M". In this case C=100. One could have the following solution:

    $$
    \begin{bmatrix}
        A_{11} & 60 & 30 & 10 \\
        A_{12} & 10 & 60 & 30 \\
        A_{13} & 30 & 10 & 60 \\\hline
        \vdots & \vdots & \vdots & \vdots \\\hline
        A_{n1} & H_i & H_j & H_k \\
        A_{n2} & H_k & H_i & H_j \\
        A_{n3} & H_j & H_k & H_i \\\hline
        \vdots & \vdots & \vdots & \vdots \\\hline
        A_{3M1} & 50 & 40 & 10  \\
        A_{3M2} & 10 & 50 & 40  \\
        A_{3M3} & 40 & 10 & 50  \\\hline
    \end{bmatrix}
    $$

    We need to comply with having at least one aircraft assigned to each mission per month. Since we have 3M aircraft, we can do this exactly by assigning all slots.

    The solution to this problem should give a solution to the Three Partition Problem. It would just suffice to take the three missions assigned to each fleet (the order is irrelevant) and use this as a solution of M groups (corresponding to M fleets). In other words, the contents of the variable $F_{ij}$.

    It's true that in the original problem we do not have the concept of fleet... but maybe we can reformulate the definitions to make it even easier.

    I think we could get the fleet part out if we would guarantee that each aircraft has an "alldifferent" assignment of three missions. This would guarantee that the solution of the problem would still be equivalent to the fleet one.

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{3 Dimensional matching}

Here I want to prove that... I need three dimensions. Resource-months, Mission-months and cycles.

I want to decide if a task-month is assigned to a resource-month inside the cycle.

Possibilities are constrained by saying.
Every misision-month needs to be covered.
Every resource-month needs to be covered.

\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{other notes}

If I take the shifts models that were polynomial... given that they become hard when adding limits on the number of shifts per planning horizon and if I have flight hours that vary between "shifts"; this means that I can traduce the flight hours in this... maybe? see: 2.4.3 from \cite{Smet2015}.


\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Crew scheduling variant 2}

    Based on an existing problem formulated in \cite{Smet2015} and proved in \cite{Brunner2013}.


    \subsection{Base problem}

    The problem is described in \cite{Smet2015}, almost verbatim, as the following:

    The objective of the problem discussed by \cite{Brunner2013} is to minimize the size of the workforce. Apart from coverage requirements, expressed as a minimum ($b_{k}$), there are three other constraints. The first constraint limits the number of days worked to a maximum value ($\overline{D}^{work}$). The second and third constraints define a range on the number of consecutive days worked ($\underline{D}^{on} - \overline{D}^{on}$) and days-off ($\underline{D}^{off} - \overline{D}^{off}$), respectively.

    \subsection{Reduction}

    Now, a simplified description of our original problem is done so that it complies with the above one. For reference, see the original description of the problem at the beginning of this document. It's an adaption of the MOSIM description.

    For each period $k$ from the original problem, we create a period $t \in \mathcal{T}$. We can use the elements in these two sets indistinctly.
    For each period $k$ with demand $b_{k}$, we create a task $j$ with $T_j = \{t\}$ that requires $R_{j} = b_{t}| t \in T_j$ resources. This implies that $J_t = \{j\}| t \in T_j$, $|J_t|=1$ and $D_t = b_{t}$.

    For each worker $i$ we have a corresponding resource $i$.
    Since all resources can cover the demand, we assume $O_i = \{j \in \mathcal{J}\}$.
    All resources start the planning horizon have just exited a maintenance in the previous period. This implies $N_t = 0$.
    The duration of the maintenance will be equal to $M = \overline{D}^{off} = \underline{D}^{off}$. This assumption is valid because the original proof was done with fixed values instead of ranges.

    The maximum remaining elapsed time after a maintenance is equal to $E = \overline{D}^{off}$. The minimum elapsed time before a maintenance is equal to $e=\underline{D}^{off}$.
    The usage time for each resource by any task will be $H_j = 0$ and the remaining usage time after a maintenance is $H = 0$. The minimum number of maintenances for each resource will be given by $M_{min}=\lceil(|\mathcal{T}| - \overline{D}^{work}) / M \rceil$. (Alternatively, the limit could be measured as a minimum number of maintenance months $M_{min}=|\mathcal{T}| - \overline{D}^{work}$).

    % \subsection{Hypothesis}

    % \begin{itemize}
    %      \item objective: minimize the number of aircraft to maximize availability.
    % \end{itemize}

    \subsection{Notations}

    \textbf{Sets}

    \begin{tabular}{ll}
        $\mathcal{T}$ & Planning horizon periods. \\
        $\mathcal{I}$ & Resources. \\
        $\mathcal{J}$ & tasks.  \\
        $\mathcal{T}_j$ &  time periods $t \in \mathcal{T}$ in which task $j$ is active. \\
        $\mathcal{J}_t $    &  tasks $j \in \mathcal{J}$ to be realized in period $t$. \\
        $\mathcal{I}_j$     &  resources $i \in \mathcal{I}$ that can be assigned to task $j$. \\
        $\mathcal{O}_i$     &  tasks $j \in \mathcal{J}$ for which resource $i$ can be used. \\
        $\mathcal{T}^{s}_t$ &  time periods $t' \in \mathcal{T}$ such that $t' \in \{ \max{\{1, t - M+1\}},  ..., {t}$\}. \\
    \end{tabular}

    \subsection{Parameters}

    \begin{tabular}{ll}
        $M_{min}$ & Minimum number of maintenances per resource in planning horizon. \\
        $M$ & Duration of maintenance. \\
        $E$ & Maximum elapsed time before assigning a maintenance. \\
        $E_{min}$ & Minimum elapsed time before assigning a maintenance. \\
        $R_{j}$ & Need of resources for task $j$. \\
    \end{tabular}

    % (here we could, in theory just copy the same model than we had in MOSIM).

    \vskip 0.3cm

     \subsection{Variables}

        \begin{tabular}{ll}
            $m_{it}$    &  =1 if resource $i \in I$ starts a maintenance operation in period $t \in \mathcal{T}$, 0 otherwise. \\
            $ret_{it}$  &  remaining elapsed time (integer) for resource $i \in I$ at the end of period $t \in \mathcal{T}$. \\  
        \end{tabular}

    \subsection{Model}

        The following modifications need to be done to the original problem described in MOSIM
        

        \begin{align}
            & ret_{it} \in [E_{min},E] 
                & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:me}\\
            & \sum_{t \in \mathcal{T}} m_{it} \geq M_{min} 
                & i \in \mathcal{I} \label{eq:min_maintenace}
        \end{align}

        Constraints (\ref{eq:me}), which already existed, now have a specific minimum value instead of just 0. Constraints (\ref{eq:min_maintenace}) are new. They put a minimum number of maintenances for each resource. This had been considered as a possible cut to the original problem and does not imply a big change to the solutions.

        The alternative to constraints (\ref{eq:min_maintenace}), in case we want to control the months under maintenance and not the number of maintenance operations, are constraints (\ref{eq:min_maintenace2}).

        \begin{align}
            & \sum_{t \in \mathcal{T}} \sum_{t' \in \mathcal{T}^{s}_t} m_{it'} \geq M_{min}
                & i \in \mathcal{I} \label{eq:min_maintenace2}\\
        \end{align}

        

        % \begin{align}
        %     % maximum capacity1:
        %     & \sum_{t' \in \mathcal{T}^{s}_t} \sum_{i \in \mathcal{I}} m_{it'} + N_t \leq m_{max}
        %       & t \in \mathcal{T} \label{eq:capacity1}\\
        %    %avail
        %    & \sum_{t' \in \mathcal{T}^{s}_t} \sum_{i \in \mathcal{I}} m_{it'} + N_t + D_t\leq u_{max} 
        %     &t \in \mathcal{T} \label{eq:avalaibility1}\\
        %    % maximum capacity2:                
        %     & \sum_{i \in \mathcal{I}_j} a_{jti} = R_j
        %             & j \in \mathcal{J}, t \in \mathcal{T}_j  \label{eq:taskres}\\
        %     & \sum_{t' \in \mathcal{T}^{s}_t} m_{it'} + \sum_{j \in \mathcal{J}_t \cap \mathcal{O}_i} a_{jti} \leq 1 
        %             & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:state}
        % \end{align}


        % \begin{align}
        %     % remaining used time
        %      & rut_{it} \leq rut_{it-1} + H m_{it} - \sum_{j \in \mathcal{J}_t \cap \mathcal{O}_i} a_{jti} H_j \notag \\
        %             && t =1, ..., \mathcal{T}, i \in \mathcal{I} \label{eq:rut_upper}\\
        %     & rut_{i0} = Rut^{Init}_i
        %            & i \in \mathcal{I} \label{eq:rut_initial}\\
        %     & rut_{it} \geq H m_{it}
        %             & t \in \mathcal{T}, i \in \mathcal{I}\label{eq:rut_lower}\\ 
        %     & rut_{it} \in [0,H]
        %             & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:mu} \\
        %     & ret_{it} \leq ret_{it-1} - 1 + E m_{it}
        %             & t =1, ..., \mathcal{T}, i \in \mathcal{I} \label{eq:ret_upper}\\
        %     & ret_{i0} = Ret^{Init}_i
        %             & i \in \mathcal{I} \label{eq:ret_initial}\\
        %     & ret_{it} \geq E m_{it}
        %             & t \in \mathcal{T}, i \in \mathcal{I}\label{eq:ret_lower}\\                 
        %     & ret_{it} \in [0,E]
        %             & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:me}\\
        %     & \sum_{i \in \mathcal{I}} ret_{it} \geq Ret^{Init}_{sum}
        %           & t = |\mathcal{T}| \label{eq:min_ret}\\
        %     & \sum_{i \in \mathcal{I}} rut_{it} \geq Rut^{Init}_{sum}
        %           & t = |\mathcal{T}| \label{eq:min_rut}
        % \end{align}
    % \begin{align}
    %     & \text{Min}\; \sum_{i \in \mathcal{I}} y_{i} \label{min_num_resources}
    % \end{align}

    % \begin{align}
    %     & \sum_{i \in \mathcal{I}} x_{it} \geq b_t & t \in \mathcal{T} \label{demand3} \\
    %     & \sum_{t \in \mathcal{T}} x_{it} \leq \overline{D}^{work} & i \in \mathcal{I} \label{max_work} \\
    %     & \sum_{t' = t}^{\overline{D}^{on}+t-1} x_{it'} \leq \overline{D}^{on} & i \in \mathcal{I}, t \in \mathcal{T} \label{max_work_days} \\
    %     & \sum_{t' = t}^{\underline{D}^{on}+t-1} x_{it'} \geq \underline{D}^{on} (x_{it} - x_{it-1}) & i \in \mathcal{I}, t \in \mathcal{T} \label{min_work_days} \\
    %     & \sum_{t' = t}^{D^{off}+t-1} (1 - x_{it'}) \leq D^{off} & i \in \mathcal{I}, t \in \mathcal{T} \label{max_no_work_days} \\
    %     & \sum_{t' = t}^{D^{off}+t-1} (1 - x_{it'}) \geq D^{off} (- x_{it} + x_{it-1}) & i \in \mathcal{I}, t \in \mathcal{T} \label{min_no_work_days} \\
    %     & y_{i} \geq x_{it} & i \in \mathcal{I}, t \in \mathcal{T} \label{num_resources} \\
    %     & x_{it}, y_{i} \in \{0, 1\} & i \in \mathcal{I}, t \in \mathcal{T} \label{binary}
    % \end{align}

    % Constraints (\ref{demand3}) guarantee the necessary number of workers is available to work. 
    % Constraints ((\ref{max_work}) checks that the total number of working days for each worker is less than the upper limit.
    % Constraints (\ref{max_work_days} - \ref{min_work_days}) control the resources meet the range of working days. Constraints (\ref{max_no_work_days} - \ref{min_no_work_days}) control the resources meet the fixed number of non-working days.
    % Finally constraints (\ref{num_resources}) quantify the number of necessary workers in the planning to be minimized in (\ref{min_num_resources}).

\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Fixed interval scheduling}

    From \cite{Smet2015}, \cite{Kolen2007} and \cite{Kovalyov2007}.


    \subsection{Base problem}

    \cite{Smet2015} calls it "shift minimization personnel task scheduling problem. When it's not related to workers and in a more general way, it's usually called "Fixed Interval Scheduling Problem".

    Here is the description of \cite{Smet2015}:

    Let $P = {1, ..., n}$ be the set of tasks to be assigned and $E = {1, ..., m}$ the set of employees. Each task $p \in P$ has a duration $u_p$ , a start time $s_p$ and a finish time $f_p$ = $s_p + u_p$ . Each employee $e$ has a set of tasks $P_e \in P$ that he/she can perform. Similarly, for each task $p$, a set $E_p \in E$ exists, which contains all employees that can perform task $p$. Both $T_e$ and $E_p$ are defined based on qualifications, time windows of tasks and availabilities of employees.

    The reference problem has the following characteristics.

    $i \in \mathcal{P}_{ref}$:

    \begin{tabular}{ll}
        $\mathcal{E}$       & Employees. \\
        $\mathcal{P}$       & tasks.  \\
        $u_p$     			&  Duration of task $p$. \\
        $s_p$     			&  Starting times $p$. \\
        $f_p$     			&  finish time of task $p$. \\
        $S_e$     &  Set of tasks an employee $e$ can perform. \\
        $E_p$ &  Set of employees that can perform task $p$. \\
    \end{tabular}

    \subsection{Reduction}

    Now, a simplified description of our original problem is done so that it complies with the above one. For reference, see the original description of the problem at the beginning of this document. It's an adaption of the MOSIM description.

    % For each employee $e \in E$, we create an analogous resource $i \in I$ which we will use indistinctly. 

    % For each task $j \in J$, we create a $j \in J$ task in our problem with duration and minimal assignment time equal to $A^{min}_j = u_j$. Start times and finish times define the moment when the task is active: $\mathcal{T}_j = t \in \{s_j ... f_j\}$. The need of resources for each task will be constant $R_{j} = 1$. The number of resources working at any given time can $D_t = |\mathcal{J}_t|$ can be calculated. The relationship between tasks and employees is also equivalent: $\mathcal{O}_i = J_i$ and $\mathcal{I}_j = E_j$.

    % The usage time for each resource by any task will be $H_j = 0$ and the remaining usage time after a maintenance is $H = 0$.
    % For maintenances, we can just take them out of the equation completely. For this we just need to put: $E_{min} = E = M = N_t = 0$ and $Ret^{Init}_{i} = |\mathcal{T}| + 1$.

    % An instance of our problem is the following:

    % \subsection{Notations}

    The FMP problem has the following characteristics.

    $I(i \in \mathcal{P}_{FMP})$:

    \vskip 0.3cm

    \textbf{Sets}

    \begin{tabular}{l|l|l}
    	\textbf{FMP}    &  \textbf{Meaning} & \textbf{I(i)} \\ \hline
        $\mathcal{T}$    &  Planning horizon. & $\{\min_p({s_p}) ... \max_p({f_p})\}$ \\
        $\mathcal{I}$    &  Resources. & $ \mathcal{E}$ \\
        $\mathcal{J}$    &  Tasks.  & $ P$ \\
        $\mathcal{T}_j$  &  time periods in which task $j=p$ is active. & $t \in \{s_p ... f_p\}$ \\
        $\mathcal{J}_t$  &  tasks to be realized in period $t$. & $j | t \in \{s_p ... f_p\}$ \\
        $\mathcal{I}_j$  &  resources that can be assigned to task $j=p$. & $E_p$\\
        $\mathcal{O}_i$  &  tasks for which resource $i=e$ can be used. & $P_e$ \\
        $\mathcal{T}^{s}_t$ &  time periods $t' \in \mathcal{T}$ that control de maintenance starts. & $\{\}$ \\
    \end{tabular}

    \vskip 0.3cm

    \textbf{Parameters}

    \begin{tabular}{l|l|l}
    	\textbf{FMP}    &  \textbf{Meaning} & \textbf{I(i)} \\ \hline
        $D_t$            & number of resources to be assigned in total in period $t$ & $|\mathcal{J}_t|$\\
        $A^{min}_j$      & minimum number of consecutive periods for task $j=p$. & $u_p$ \\
        $Ret^{Init}_{i}$ & remaining elapsed time for resource $i$ at the start. & $|\mathcal{T}| + 1$ \\
        $R_{j}$          & Need of resources for task $j$ & $1$ \\
        $H_j$             & amount of resource time required by task $j$. & $ 0$ \\
        $M$               & maintenance duration in number of periods. & $ 0$ \\
        $E$               & remaining elapsed time after a maintenance. & $ 0$ \\
        $H$               & remaining usage time after a maintenance.& $ 0$ \\
        $N_t$             & number of resources in already-planned maintenances in period $t$. & $0$ \\
        $Rut^{Init}_{i}$  & remaining usage time for resource $i$ at the start of the planning horizon. & $ 0$ \\
        $Ret^{Init}_{sum}$& sum of remaining elapsed times at the start of the planning horizon. & $ 0$\\
        $Rut^{Init}_{sum}$& sum of remaining elapsed time at the start of the planning horizon. & $ 0$ \\
    \end{tabular}

$Q_{ref}$: For an instance $i \in \mathcal{P}_{ref}$, $\exists$ a solution with the number of resources $\leq k$:

$Q_{FMP}$: For an instance $I(i \in \mathcal{P}_{ref})$, $\exists$ a solution with the number of available resources $\geq |I| - k$:


\clearpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% \bibliographystyle{dcu}
\bibliographystyle{alpha}
\bibliography{./../../biblio/Scheduling,./../../biblio/NRP}

\end{document}



