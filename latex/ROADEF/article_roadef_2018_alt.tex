\documentclass{roadef}
\usepackage{amsmath}

% \usepackage{fontspec}
% This command is to use simple quotes inside math expressions:
\newcommand{\mq}[1] {`#1\textrm'}

\begin{document}


% Le titre du papier
\title{Maintenance planning on French military aircraft operations}

% Le titre court
% \def\shorttitle{Titre court}

\author{Franco Peschiera\inst{1}, Alain Haït\inst{1}, Olga Battaïa\inst{1}, Nicolas Dupin\inst{1}}


\institute{
Institut Supérieur de l'Aéronautique et de l'Espace \\
\email{\{franco.peschiera,alain.hait,olga.battaia,nicolas.dupin\}@isae-supaero.fr}
}


\maketitle
\thispagestyle{empty}

\keywords{optimization, planning, military, maintenance}


\section{Introduction}
    The Military Flight and Maintenance Planning is a problem consisting on the assignment of missions and maintenance tasks to military aircraft. It is a variant of the Flight and Maintenance Planning problem where flights are not modeled geographically but they are assumed to include a round-trip to the base. It also includes different objectives and constraints. Although the former has been studied in literature in \cite{Cho2011,Chastellux2017,Kozanidis2008,Verhoeff2015}, it has not received as much attention as the latter.

    % First of all, the objective function's motivation is on reducing the load on the maintenance facilities and guaranteeing the availability of the fleet instead of reducing the cost. Also, the maintenance operations take considerably longer and the rules that govern the maintenances are different.

    % The temporal scope of the problem is also bigger, making the normal planning horizon bigger and each period bigger too: months instead of days. On the other hand, the physical scope, while present in the commercial planning, is not present in the military one: aircraft are assumed to return to the origin every time.

    % Finally, there are some particular constraints that are specific for this specific problem that have not been found in other works. For example: the possibility to temporally stock the aircraft, the treatment of missions as a complex tasks with requirements and not as an aggregate periodic demand among others.


%\section{The problem}

    The problem consists in the planning of the maintenance operations for military aircraft and the assignment of these aircraft to already scheduled missions. In order to generalize the formulation, from now on aircraft will be named "resources" and missions will be named "tasks". A series of $j \in \mathcal{J}$ tasks are planned along a horizon divided into $t \in \mathcal{T}$ periods. Each task requires a certain number $r_{j}$ of resources $i \in \mathcal{I}$ which it employs for a time duration defined by $h_j$ in each period. Set $cd_{j} \subset \mathcal{I}$ lists the resources that can be assigned to each task.

    % The assignment of a resource to a task is not decided for the whole duration of the task. After a minimum amount of time ($minTIME_j$), a resource can be freed and exchanged for another one, even if the task it is assigned to has not finished. The total number of resources being used at any given time in a specific task can never be less than the required $REQ_{vt}$.

    % \subsection{iesources}
    % \label{def:resource}

    Resources require recurrent preventive maintenance operations. The frequency of maintenance operations is defined by 2 factors: the amount of time $me$ elapsed since the last maintenance operation and the amount of time $mu$ for which the resource has been used since the last maintenance operation. A maintenance operation takes an amount of time equal to $md$ periods and cannot be interrupted. Resources start with a number of remaining elapsed and usage time of $retInit_i$ and $rutInit_i$ respectively. In the following section we present a new mathematical model for this problem.
    % We will call "remaining elapsed time" (or $ret$) to the amount of time that needs to pass in order for the resource to need a maintenance at any given period.

    % We will call "remaining usage time" (or $rut$) to the amount of time that the resource needs to be used in order for it to need a maintenance at any given period.

    % Additionally, after an absolute amount of time and/or usage ($AET$ or $AUT$), the resource becomes obsolete. There is no way to reverse this process.

    % Each resources starts the planning period with a specific status given by:

    % \begin{itemize}
    %     \item remaining usage time.
    %     \item remaining elapsed time.
    %     % \item remaining absolute elapsed time.
    %     % \item remaining absolute usage time.
    %     % \item LastMaintenanceType (see \ref{def:maint}).
    % \end{itemize}

    % Finally, resources are organized into families or groups. Each resource inside in a family or group shares the same types of maintenances and, usually, the same kind of tasks, among other information.

    % \paragraph{iesource's states}
    % \label{def:res-state}

    % \begin{itemize}
    %     \item Assigned to a task (see \ref{def:task}).
    %     \item Under maintenance (see \ref{def:maint}).
    %     % \item Under storage (see \ref{def:sto}).
    %     \item Waiting maintenances.
    %     % \item Obsolete.
    %     \item Available (none of the above).
    % \end{itemize}

    % \subsection{Maintenances}
    % \label{def:maint}

    % Maintenances are the process by which resources that have reached a limit in their usage (but not their absolute limit) can return to a state where they can continue to be used in tasks.

    % Each maintenance belongs to a specific type of maintenance $m \in \mathcal{M}$. These types of maintenance differentiate between each other by having different characteristics.

    % The state of the resource after exiting the maintenance period is of "as good as new" in terms of the two indicators that decide the maintenance.
    
    % In other words, after receiving a maintenance, a resource restores its remaining elapsed time and remaining usage time back to their max values $me$ and $mu$ respectively.

    % Not all maintenances are the same for any given resource. Each resources follows a sequence of maintenances. In other words, the second maintenance of a given resource is different in nature from the first maintenance for that same resource. Examples of differences on consecutive maintenances for a given resource are the duration ($mTIME_m$) it takes or whether it restores storage capacity (see \ref{def:sto}).

    % \subsection{Storage}
    % \label{def:sto}

    % We have already explained that even if a resource is not being used, it still needs to have a maintenance after a given amount of time (govern by the elapsed time $elapsedTIME$). In order to avoid this problem, the resource can be put into a "storage" state.

    % A resource in this states has to be kept for a minimum time of $sMin$ periods. While in this state it cannot receive maintenance or be tasked any task.

    % Every resource has the capacity to be stored, although it is limited. This capacity (measured in a number of periods $sCap$) is expended every time the resource is stored. In order for a resource to reset its remaining storage capacity, it needs to received a specific maintenance (see \ref{def:maint}).

    % \subsection{Objectives}
    
    % The are multiple objectives that need to be taken into account. 

    % Given that the creation of new tasks and the duration of maintenance times are considered stochastic, the basic goal is to maximize the robustness of the planning. 

    % Given the limited amount of maintenance capacity and its cost, another goal is to smooth as much as possible the maintenance tasks over the planning horizon.

    % \begin{enumerate}
    %     \item Maximize the minimum number of available resources (see \ref{def:res-state}) in any given period.
    %     \item Minimize the maximum number of resources under maintenance in any given period.
    % \end{enumerate}

\section{Mathematical model}

    % \subsection{Decisions}

    % \subsection{Parameters}

    % \begin{tabular}{p{10mm}lp{110mm}}
    % $c_t$            & : & number of resources that can be in maintenance in period $t$. \\
    % $cd_j$           & : & resources that satisfy task's $j$ needs. \\
    % $h_{vt}$        & : & time consumed of any resource when assigned to task $j$ in period $t$. \\
    % $r_{vt}$        & : & number or resources to assign to task $j$ in period $t$. \\            
    % $mu$             & : & maximum used time for each resource between maintenances. \\    
    % $me$             & : & maximum elapsed time for each resource between maintenances. \\    
    % $md$             & : & maintenance duration, in periods. \\        
    % $rut\_i_a$       & : & remaining used time for resource $i$ at the beginning of horizon. \\        
    % $ret\_i_a$       & : & remaining elapsed time for resource $i$ at the beginning of horizon. \\
    % $state\_i_{it}$  & : & some $s \in \mathcal{S}$ in case the resource $i$ has a fixed state. \\
    % \end{tabular}
    % \bigskip

    % \subsection{Variables}

    The decision variables manage the previously defined resources. We can summarize the main decisions the following way: if resource $i$ starts maintenance in period $t$ and if resource $i$ is assigned to task $j$ in period $t$. We will call $\mathcal{T}_0$ to periods that include the period before the first, $0$, and $d_t$ the number of resources assigned to some task in period $t$. Based on decisions made before the planning horizon, we use $m_{it}$ as a binary parameter whose value is equal to 1 if a resource is (still) in maintenance in period $t$ and 0 otherwise. This parameter only should take some value in the first $md-1$ periods of the planning horizon.

    \begin{tabular}{p{15mm}lp{105mm}}
        $A_{ijt}$           & = & 1 if resource $i \in cd_j$ is assigned to task $j$ in period $t$, 0 otherwise. \\  
        % $state_{ist}$       & = & 1 if resource $i$ is in state $s$ in period $t$, 0 otherwise. \\  
        $M_{it}$            & = & 1 if resource $i$ starts maintenance in period $t$, 0 otherwise. \\
        $rut_{it}$          & = & remaining usage time (continuous) for resource $i$ after period $t \in \mathcal{T}_0$. \\  
        % $ret_{it}$          & = & remaining elapsed time (integer) for resource $i$ after period $t \in \mathcal{T}0$. \\  
        % $used_{it}$         & = & time (integer) used by resource $i$ in period $t$. \\
        $Umax$        & = & max number (integer) of unavailable resources in any period. \\
        $Mmax$        & = & max number (integer) of resources in maintenance in any period. \\
    \end{tabular}
    \bigskip

    % \subsection{Constraints}

    The objective is to both minimize the maximum number of maintenances and the maximum number of unavailable aircraft:

    \begin{align}
        & \text{Min}\, (Mmax) \\
        & \text{Min}\, (Umax)
    \end{align}

    Subject to:
        
    \begin{align}
        %%%%%%%%%%%%%%%%%%%
        % MAIN CONSTRAINTS
        %%%%%%%%%%%%%%%%%%%
        % maximum capacity:
        & \sum_{t = \max{(1, t' - md+1)}}^{t'} \,\, \sum_{i \in \mathcal{I}} M_{it} + \sum_{i \in \mathcal{I}} m_{it'} \leq Mmax
                & t' \in \mathcal{T} \label{eq:capacity}\\
        % minimum resources
        & \sum_{i \in cd_j} A_{ijt} \geq r_{j}
                & t \in \mathcal{T}, j \in \mathcal{J} \label{eq:taskres}\\
        % max one task per period
        % & \sum_{j \in \mathcal{J}} A_{ijt} \leq 1
        %         & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:maxtasks}\\
        % if assigned to task: in working state
        % & state_{ist} \geq A_{ijt} 
        %         & \hspace{10mm} t \in \mathcal{T}, r \in cd_j, j \in \mathcal{J}, s = \mq{V} \label{eq:state1}\\
        % if no working state, no assigned to any task
        % & state_{ist} + A_{ijt} \leq 1
        %         & \hspace{10mm} t \in \mathcal{T}, r \in cd_j, j \in \mathcal{J}, s \neq \mq{V} \label{eq:state3}\\
        % only one state. If we take out the 'do nothing' state, this could be \leq
        % & \sum_{s \in \mathcal{S}} state_{ist} = 1 
        %         & \hspace{10mm} t \in \mathcal{T}, i \in \mathcal{I} \label{eq:state2}
        % or maintenance or task:
        & \sum_{t = \max{(1, t' - md+1)}}^{t'} M_{it} + \sum_{j \in \mathcal{J}} A_{ijt'} + m_{it'} \leq 1
                & t' \in \mathcal{T}, i \in \mathcal{I} \label{eq:state}
    \end{align}

    % $$H*M_{it'} - Heures de vol entre t_1 et t' \leq H*(M_{it_1}+1) i \in I, t' \geq t-1 \in T$$
    % $$t_1M_{it_1} \geq t'M_{it'} - D_{max} \foreach i \in I, t'>t-1, t_1\geq D_{max}-D_i$$

    % These constraints are the the main constraints of the model.
    % The number of resources assigned to a single task and under maintenance 
    Tasks' resource requirements are defined by \ref{eq:taskres}, maintenance capacity is controlled by \ref{eq:capacity}. Maximum tasks and maintenance assigned to each resource is guaranteed by \ref{eq:state}.
        
    \begin{align}
        %%%%%%%%%%%%%%%%%%%
        % BALANCES
        %%%%%%%%%%%%%%%%%%%
        % definition of consumed resource hours:
        % & used_{it} \geq \sum_{j \in \mathcal{J}} A_{ijt} \times h_{j}
        %         & i \in \mathcal{I}, t \in \mathcal{T} \label{eq:usage}\\
        % definition of consumed resource hours (bigger):
        % & used_{it} \geq A_{ijt} \times h_{j}
        %         & i \in \mathcal{I}, t \in \mathcal{T}, j \in \mathcal{J} \label{eq:usage2}\\
        % remaining used time
        & rut_{it} \leq (rut_{it-1} - \sum_{j \in \mathcal{J}} A_{ijt} \times h_{j}) + (mu \times M_{it})
                & t \in {1..\mathcal{T}}, i \in \mathcal{I} \label{eq:balance1}\\
        % remaining elapsed time. TODO: improve this constraint like the maintenance state duration
        % & ret_{it} \leq (ret_{it-1} - 1) + (me \times M_{it})
        %         & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:balance2}\\
        & rut_{i0} = rutInit_r
                & i \in \mathcal{I} \label{eq:initial}\\
        % & ret_{it} = retInit_r
        %         & t = 0, i \in \mathcal{I} \label{eq:initial2}\\
        % & ret_{it} \leq me
        %         & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:me}\\
        & rut_{it} \leq mu
                & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:mu}\\
        & rut_{it} \geq mu \times M_{it}
                & t \in \mathcal{T}, i \in \mathcal{I} \label{eq:balance2}\\
        & \sum_{t = \max{(1, t' - md+1)}}^{t'} \,\, \sum_{i \in \mathcal{I}} M_{it} + d_{t'} + \sum_{i \in \mathcal{I}} m_{it'} \leq Umax
                & \hspace{10mm} t' \in \mathcal{T}  \label{eq:available}
        % TODO: add the constraints for the beginning of the period.
    \end{align}
    
    % These constraints calculate the balances of hours for each resource.

    The monthly remaining usage time is calculated by \ref{eq:balance1}. The initial states is governed by \ref{eq:initial} and the limit by \ref{eq:mu} and \ref{eq:balance2}. The availability of resources is calculated in \ref{eq:available}.
     % This is then applied in \ref{eq:balance1} to get the remaining usage time at each period for each resource. Similarly, the \ref{eq:balance2} calculates the remaining elapsed time at each period and resource.        

    % \begin{align}
        %%%%%%%%%%%%%%%%%%%
        % STATES
        %%%%%%%%%%%%%%%%%%%
        % if start maintenance, at least X periods
        % & state_{ist'} \geq M_{it_1} 
        %         & \hspace{10mm} (t_1, t') \in \mathcal{T}, t_1 \leq t' \leq t_1 + md - 1, i \in \mathcal{I}, s = \mq{M} \label{eq:start1}\\
        % % if maintenance doesn't start, we cannot have maintenance:
        % & \sum_{t_1 \in \mathcal{T}} M_{it_1} \geq state_{ist'} 
        %         & \hspace{10mm} t' \in \mathcal{T}, t_1 \leq t' \leq t_1 + md - 1, i \in \mathcal{I}, s = \mq{M} \label{eq:start2}\\
        % availqbility definition:
        % & Umax \leq \sum_{i} state_{ist}
        %         & \hspace{10mm} t \in \mathcal{T}, i \in \mathcal{I}, s = \mq{A} \label{eq:available}
    % \end{align}

    % These constraints involve the states assignments to resources.

    % The coupling between the start of each maintenance and the maintenance state is done by \ref{eq:start1} and \ref{eq:start2}. The definition of the previously mentioned objective is done by \ref{eq:available}.
    % This way resources need to have started a maintenance to receive it and have to have maintenance for a minimum period after having starting it.

    % \begin{align}
        %%%%%%%%%%%%%%%%%%%
        % OBJECTIVE
        %%%%%%%%%%%%%%%%%%%
        % min available
        % max maintenance
        % & Mmax \geq \sum_{i} state_{ist}
        %         & \hspace{10mm} t \in \mathcal{T}, i \in \mathcal{I}, s = \mq{M} \label{eq:maintenance}
    % \end{align}

    % These constraints define the possible objectives.
    

    % The minimum number of available resources in any period is controlled by \ref{eq:available}. The definition of the maximum number of resources under maintenance in any period is done by \ref{eq:maintenance}.

    % \begin{align}
    %     %%%%%%%%%%%%%%%%%%%
    %     % HORIZON
    %     %%%%%%%%%%%%%%%%%%%
    %     % TODO: initialize maintenance states too!
    %     % rut initialize
    %     & rut_{it} = rut\_ini_a
    %             & \hspace{10mm} t = 0, i \in \mathcal{I} \label{eq:remaining1}\\
    %     % ret initialize
    %     & ret_{it} = ret\_ini_a
    %             & \hspace{10mm} t = 0, i \in \mathcal{I} \label{eq:remaining2}\\
    %     % fixed states during planning period
    %     & state_{ist} = 1
    %             & \hspace{10mm} t \in \mathcal{T}, i \in \mathcal{I}; s \in \mathcal{S}\, | if\, state\_ini_{it} = s \label{eq:fixedstates}
    % \end{align}

    % % These constraints feed the relevant historic data for resources.

    % The last period's remaining used and elapsed time are filled by \ref{eq:remaining1} and \ref{eq:remaining2} respectively.

    % In order to fix the states to their planned state we need \ref{eq:fixedstates}. This is specially useful for the beginning of the planning period, where we could have maintenance states already decided for some resources.

\section{Conclusions and future work}
    
    The present work proposes a new model for dealing with the Military Flight and Maintenance Problem. Unlike previous work, it assigns aircraft to missions, instead of just using an aggregate demand. This will permit the future addition of conditions such as a minimum assignment time of aircraft to missions, the differentiation of types of aircraft and the possibility to put aircraft into storage.


% La bibliographie

\bibliographystyle{plain}
% \selectlanguage{english}
\bibliography{MFMP}
% \begin{thebibliography}{2}
% \bibitem{toth02}
% Paolo Toth and Daniele Vigo.
% \newblock \emph{The Vehicle Routing Problem}.
% \newblock Monographs on Discrete Mathematics and Applications. Society for Industrial and Applied Mathematics, 2002.
% \bibitem{kirkpatrick83}
% Scott Kirkpatrick, C~Daniel Gelatt, and Mario~P Vecchi.
% \newblock Optimization by simmulated annealing.
% \newblock \emph{science}, 220\penalty0 (4598):\penalty0 671--680, 1983.


% \end{thebibliography}


\end{document}
